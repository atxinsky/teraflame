# 德州扑克游戏开发文档

## 项目概述

这是一个基于Python和Pygame的单机版德州扑克游戏，实现了完整的德州扑克游戏规则和交互界面。玩家可以与AI对手进行德州扑克比赛，体验完整的游戏流程。

## 技术架构

### 开发环境

- 编程语言：Python 3.6+
- 游戏框架：Pygame 2.0+
- 开发平台：跨平台（Windows, macOS, Linux）

### 项目结构

项目采用模块化设计，主要分为以下几个部分：

1. **游戏逻辑模块**（`src/game/`）：负责实现德州扑克的核心规则和逻辑
2. **用户界面模块**（`src/ui/`）：负责绘制游戏界面和处理用户输入
3. **工具模块**（`src/utils/`）：提供辅助功能和常量定义
4. **资源文件**（`assets/`）：包含游戏使用的图像、音效和字体资源

主要模块之间的关系如下：

```
main.py  ---->  GameInterface  ---->  PokerTable
   |               |                     |
   |               |                     |
   v               v                     v
  Game  <----  动画系统  <----  玩家显示和按钮
   |
   |
   v
AI, 玩家, 牌组, 手牌评估
```

## 核心模块说明

### 游戏逻辑（Game）

`src/game/game.py` 实现了德州扑克的核心游戏逻辑，包括：

- 游戏状态管理
- 发牌和回合控制
- 玩家动作处理
- 手牌评估和赢家判定
- AI决策逻辑

主要类和方法：

- `Game` 类：管理整个游戏流程
  - `start_new_hand()` - 开始新的一手牌
  - `process_player_action()` - 处理玩家行动
  - `update()` - 更新游戏状态
  - `showdown()` - 处理摊牌阶段

### 卡牌系统

- `Card` 类（`src/game/card.py`）：表示单张扑克牌
- `Deck` 类（`src/game/deck.py`）：表示一副扑克牌，负责洗牌和发牌

### 玩家系统

- `Player` 类（`src/game/player.py`）：表示玩家，包括人类玩家和AI玩家
- `PokerAI` 类（`src/game/ai.py`）：实现AI决策逻辑

### 手牌评估

- `HandEvaluator` 类（`src/game/hand.py`）：评估扑克牌组合的强度

### 用户界面

- `GameInterface` 类（`src/ui/interface.py`）：管理整个游戏界面
- `PokerTable` 类（`src/ui/table.py`）：绘制扑克桌和布局
- `Button` 和 `SliderButton` 类（`src/ui/button.py`）：交互控件
- `AnimationManager` 类（`src/ui/animation.py`）：管理游戏动画效果
- 各种菜单类（`src/ui/menu.py`）：实现游戏菜单系统

## 关键算法

### 1. 手牌评估算法

评估玩家手牌强度的算法是游戏的核心部分之一。实现在 `HandEvaluator` 类中，主要步骤如下：

1. 合并玩家的底牌和公共牌（最多7张牌）
2. 从这些牌中找出形成最强牌型的5张牌
3. 按照牌型等级和牌面值大小计算手牌强度值
4. 返回手牌类型、强度值和描述

### 2. AI决策算法

AI决策算法实现在 `PokerAI` 类中，核心思路如下：

1. 评估当前手牌强度
2. 估计胜率（基于手牌强度、游戏阶段和玩家数量）
3. 考虑位置因素（早位、中位、晚位）
4. 分析底池赔率
5. 加入随机因素和诈唬倾向
6. 选择最佳行动（弃牌、看牌、跟注、加注或全押）

AI难度级别通过调整以下参数实现：
- 手牌评估精确度
- 诈唬频率
- 激进程度
- 位置意识

### 3. 动画系统

动画系统通过以下类实现：

- `CardDealAnimation`：实现发牌动画
- `ChipsAnimation`：实现筹码移动动画
- `TextAnimation`：实现文本动画效果
- `WinnerAnimation`：实现获胜动画效果

动画基于时间控制，而不是帧数，确保在不同帧率下有一致的体验。

## 数据流

1. 用户输入通过 `GameInterface` 处理，转化为游戏动作
2. 游戏动作传递给 `Game` 类处理
3. `Game` 类更新游戏状态和玩家信息
4. 更新后的状态反馈给 `GameInterface` 进行渲染
5. AI玩家通过 `PokerAI` 类生成决策并传递给 `Game` 类

## 扩展指南

### 添加新功能

1. **多人联网模式**
   - 添加网络通信模块
   - 实现客户端-服务器架构
   - 添加用户认证和会话管理

2. **锦标赛模式**
   - 实现锦标赛结构和进程管理
   - 添加盲注自动增长机制
   - 增加排名和奖励系统

3. **自定义规则**
   - 扩展游戏配置系统
   - 允许自定义盲注、起始筹码等
   - 支持奥马哈等变体规则

### 修改现有功能

1. **调整AI难度**：修改 `src/game/ai.py` 中的行为参数
2. **更改游戏界面**：修改 `src/ui/interface.py` 和 `src/ui/table.py`
3. **添加新的动画效果**：扩展 `src/ui/animation.py`

## 已知问题

1. AI在某些边缘情况下可能做出非最优决策
2. 大量动画同时播放可能导致性能下降
3. 尚未实现多人联网功能

## 未来计划

1. 优化AI决策算法
2. 添加更多游戏统计和分析功能
3. 实现排行榜和成就系统
4. 添加扑克教学模式
5. 支持多种语言

## 贡献指南

1. 遵循PEP 8编码规范
2. 为新功能添加单元测试
3. 更新文档以反映代码变更
4. 提交前运行测试确保代码质量

## 许可说明

本项目采用MIT许可证。详见LICENSE文件。
